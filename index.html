<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>STACHUS: DEBUG MODE</title>
    <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>

    <style>
        /* 基础样式 */
        :root { --bg-color: #050505; --accent-green: #00ff41; --alert-red: #ff0055; }
        body { margin: 0; background: var(--bg-color); color: #fff; font-family: 'Share Tech Mono', monospace; overflow: hidden; }
        
        /* 屏幕管理 */
        .game-screen { position: absolute; inset: 0; display: none; flex-direction: column; justify-content: center; align-items: center; background: #000; z-index: 10; }
        .game-screen.active { display: flex; }

        /* 1. 简报页 */
        #screen-briefing { padding: 20px; text-align: center; border: 2px solid var(--accent-green); margin: 20px; }
        .btn-start { background: var(--accent-green); color: #000; border: none; padding: 15px 30px; font-family: inherit; font-size: 1.2rem; cursor: pointer; margin-top: 20px; }

        /* 2. 地图页 (修复版) */
        #map-container { 
            width: 100%; height: 100%; position: relative; 
            /* ⚠️ DEBUG FIX: 强制网格背景，防止没图黑屏 */
            background: #0a0a15;
            background-image: 
                linear-gradient(rgba(0, 255, 65, 0.1) 1px, transparent 1px),
                linear-gradient(90deg, rgba(0, 255, 65, 0.1) 1px, transparent 1px);
            background-size: 40px 40px;
        }
        /* 如果你有 map.jpg，它会覆盖上面的网格 */
        #map-bg { 
            position: absolute; inset: 0; 
            background-image: url('./map.jpg'); 
            background-size: cover; background-position: center; 
            opacity: 0.5; /* 半透明，透出一点网格 */
        }

        /* Marker 样式 */
        .marker { 
            position: absolute; width: 40px; height: 40px; 
            border: 2px solid var(--alert-red); background: rgba(255,0,85,0.2); 
            transform: translate(-50%, -50%) rotate(45deg); cursor: pointer; 
            animation: pulse 1s infinite; z-index: 20;
        }
        .marker.purged { border-color: #555; background: transparent; animation: none; }
        @keyframes pulse { 0%{transform:translate(-50%,-50%) rotate(45deg) scale(1);} 50%{transform:translate(-50%,-50%) rotate(45deg) scale(1.1);} }

        /* 3. 弹窗 UI */
        #modal { position: fixed; inset: 0; background: rgba(0,0,0,0.9); z-index: 100; display: none; flex-direction: column; padding: 30px; }
        #normalize-btn { margin-top: auto; padding: 15px; background: transparent; border: 1px solid var(--alert-red); color: var(--alert-red); font-family: inherit; }

        /* 4. 重构页 */
        #screen-reconstruct { background: #000; }
    </style>
</head>
<body>

    <div id="screen-briefing" class="game-screen active">
        <h1>MISSION BRIEFING</h1>
        <p>System anomaly detected.<br>Click start to initiate protocol.</p>
        <button class="btn-start" onclick="startGame()">[ START GAME ]</button>
    </div>

    <div id="screen-map" class="game-screen">
        <div id="map-container">
            <div id="map-bg"></div> <div id="markers-layer"></div> </div>
        <div style="position:absolute; bottom:20px; left:20px; color: var(--accent-green);">
            STATUS: <span id="status-text">SCANNING...</span>
        </div>
    </div>

    <div id="modal">
        <h2 style="color:var(--alert-red)">ANOMALY FOUND</h2>
        <p id="modal-text" style="color:#ccc; line-height:1.5">...</p>
        <button id="normalize-btn" onclick="normalize()">NORMALIZE DATA</button>
        <button onclick="closeModal()" style="margin-top:10px; background:none; border:none; color:#555;">[ CANCEL ]</button>
    </div>

    <script>
        // 极简版逻辑，用于测试显示
        const archives = [
            { id: 1, text: "Memory 01: The Loop", top: '40%', left: '30%' },
            { id: 2, text: "Memory 02: The Ghost", top: '60%', left: '70%' }
        ];
        let currentIdx = -1;

        function startGame() {
            document.getElementById('screen-briefing').classList.remove('active');
            document.getElementById('screen-map').classList.add('active');
            initMarkers();
        }

        function initMarkers() {
            const container = document.getElementById('markers-layer');
            archives.forEach((d, i) => {
                const el = document.createElement('div');
                el.className = 'marker';
                el.style.top = d.top; el.style.left = d.left;
                el.onclick = () => openModal(i);
                container.appendChild(el);
            });
        }

        function openModal(i) {
            currentIdx = i;
            document.getElementById('modal').style.display = 'flex';
            document.getElementById('modal-text').innerText = archives[i].text;
        }

        function closeModal() { document.getElementById('modal').style.display = 'none'; }

        function normalize() {
            alert("DATA NORMALIZED.");
            closeModal();
            // 变灰
            document.querySelectorAll('.marker')[currentIdx].classList.add('purged');
        }
    </script>
</body>
</html>
